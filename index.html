<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Демонстрация доступности: Новые вопросы</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #eaf4f4; /* Основной фон страницы - очень светлый голубоватый */
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #eaf4f4; /* Фон контейнера такой же, как body для единой основы */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .demo-block {
            border-radius: 6px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); /* Чуть более выраженная тень */
        }

        /* Общий стиль для параграфов "Для аудитора:" */
        .auditor-note {
            font-style: italic;
            font-size: 0.95em; /* Чуть меньше основного текста */
            color: #555;
            margin-top: 20px; /* Отступ сверху */
        }
        .auditor-note strong { /* Добавлено для жирного "Для аудитора:" */
            font-weight: bold;
        }


        /* Стиль для демонстрации списка - Голубой блок */
        .list-demo {
            background-color: #e0f2f7; /* Светло-голубой */
            border: 1px solid #2c3e50; /* Темно-синяя рамка */
        }
        .list-demo ul {
            border: 1px solid #a7d9ed; /* Немного светлее, чем фон блока */
            padding: 20px;
            background-color: #effaff; /* Очень светлый голубой для внутренней части списка */
            list-style: disc inside; /* Маркеры будут только у реальных <li> */
        }
        /* Единое оформление для всех элементов, которые должны выглядеть как пункты списка */
        .list-demo ul li, /* Стиль для корректных li */
        .list-item-unified { /* Стиль для некорректных div/p, которые должны выглядеть как li */
            background-color: transparent;
            border: none;
            padding: 0;
            margin: 8px 0; /* Единый отступ для всех элементов */
            color: #333;
            font-weight: normal;
        }


        /* Стиль для демонстрации поля поиска - Светло-зеленый блок */
        .search-demo {
            background-color: #e6faed; /* Светло-зеленый */
            border: 1px solid #28a745; /* Зеленая рамка */
        }
        /* Стили для отдельных форм внутри блока */
        .search-demo form {
            margin-bottom: 20px; /* Отступ между формами */
            padding-bottom: 10px; /* Небольшой отступ внутри формы */
            border-bottom: 1px dashed #c0e0c0; /* Разделитель между формами */
            display: flex; /* Для выравнивания лейбла, инпута и кнопки в строке */
            flex-wrap: wrap; /* Позволяет элементам переноситься на новую строку на маленьких экранах */
            gap: 10px; /* Отступ между элементами */
            align-items: flex-end; /* Выравнивание элементов по низу, чтобы кнопка была внизу поля */
        }
        .search-demo form:last-of-type {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none; /* Убираем разделитель у последней формы */
        }
        .search-demo .form-group { /* Для группировки лейбла и инпута */
            flex: 1 1 auto; /* Поле занимает доступное пространство */
            display: flex;
            flex-direction: column; /* Лейбл над инпутом */
            gap: 5px; /* Отступ между лейблом и инпутом */
            min-width: 150px; /* Минимальная ширина для поля, чтобы не схлопывалось */
        }
        .search-demo label {
            font-weight: bold;
            color: #34495e;
            white-space: nowrap; /* Чтобы текст лейбла не переносился */
        }
        .search-demo input[type="search"],
        .search-demo input[type="text"] { /* Применяем к обоим типам */
            padding: 10px 12px;
            border: 1px solid #98d8ae; /* Сочетающаяся рамка для инпута */
            border-radius: 5px;
            width: 100%; /* Занимает всю ширину родительской группы */
            box-sizing: border-box; /* Учитываем padding и border в ширине */
            font-size: 1em;
        }
        .search-demo input[type="search"]:focus,
        .search-demo input[type="text"]:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
        .search-demo button {
            padding: 10px 15px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
            flex-shrink: 0; /* Чтобы кнопка не уменьшалась и не переносилась на новую строку раньше времени */
            align-self: flex-end;
            margin-bottom: 0;
        }

        .search-demo button:hover {
            background-color: #0056b3;
        }
        .search-demo button:focus {
            outline: 2px solid #0056b3;
            outline-offset: 2px;
        }


        /* Стиль для демонстрации таблицы - Оранжевый блок */
        .table-demo {
            background-color: #fff3e0; /* Светло-оранжевый */
            border: 1px solid #e65100; /* Темно-оранжевая рамка */
        }
        .table-demo table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #fff;
        }
        .table-demo th, .table-demo td {
            border: 1px solid #ffe0b2; /* Более светлая рамка таблицы */
            padding: 10px;
            text-align: left;
        }
        .table-demo th {
            background-color: #ffeccf; /* Светло-оранжевый фон заголовков */
            color: #333;
            font-weight: bold;
        }
        .table-demo caption {
            font-weight: bold;
            margin-bottom: 10px;
            caption-side: top;
            text-align: left;
            padding: 5px 0;
            color: #34495e;
        }
        .table-demo .table-controls {
            margin-top: 20px;
            text-align: center;
        }
        .table-demo .table-controls button {
            padding: 10px 20px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }
        .table-demo .table-controls button:hover {
            background-color: #218838;
        }
        .table-demo .table-controls button:focus {
            outline: 2px solid #218838;
            outline-offset: 2px;
        }
        .table-demo .table-controls button.remove-btn {
            background-color: #dc3545;
        }
        .table-demo .table-controls button.remove-btn:hover {
            background-color: #c82333;
        }
        .table-demo .table-controls button.remove-btn:focus {
            outline: 2px solid #c82333;
            outline-offset: 2px;
        }


        /* Стиль для демонстрации textarea со счетчиком - Светло-фиолетовый блок */
        .textarea-demo {
            background-color: #f7e6fa; /* Светло-фиолетовый */
            border: 1px solid #8e44ad; /* Глубокий фиолетовый рамка */
        }
        .textarea-demo label {
            font-weight: bold;
            color: #34495e;
            display: block;
            margin-bottom: 8px;
        }
        .textarea-demo textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #c39ee0; /* Сочетающаяся рамка для textarea */
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        .textarea-demo textarea:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
        .char-count {
            margin-top: 8px;
            font-size: 0.9em;
            color: #666;
            font-weight: bold;
        }
        .char-count.warning {
            color: #d39e00;
        }
        .char-count.error {
            color: #dc3545;
        }

        /* Новый блок для демонстрации aria-haspopup */
        .popup-demo {
            background-color: #f0f0f0; /* Нейтральный светло-серый */
            border: 1px solid #999;
            text-align: center;
        }
        .popup-demo button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #4CAF50; /* Зеленая кнопка */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .popup-demo button:hover {
            background-color: #45a049;
        }
        .popup-demo button:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }

        /* --- СТИЛИ ДЛЯ ДИАЛОГА APG (теперь применяются к вашему demo-modal) --- */
        /* Базовые стили для оверлея */
        .modal-overlay[aria-modal="true"] { /* Используем ваш класс modal-overlay */
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2; /* Поверх всего */
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Полупрозрачный фон */
            display: none; /* Скрыт по умолчанию */
            justify-content: center;
            align-items: center;
            font-size: 1em; /* Убедимся, что размеры соответствуют */
        }

        /* Стиль самого диалогового окна */
        .modal-content_apg { /* Добавим новый класс для контента, чтобы избежать конфликтов */
            background-color: #fff;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            max-width: 500px;
            width: 90%; /* Адаптивная ширина */
            box-sizing: border-box; /* Учитываем padding в ширине */
            position: relative;
        }

        .modal-content_apg h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: none; /* Убираем бордер, чтобы не конфликтовал с общим h2 */
            padding-bottom: 0;
            font-size: 1.5em; /* Чуть крупнее */
        }

        .modal-content_apg form div {
            margin-bottom: 15px;
        }

        .modal-content_apg label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .modal-content_apg input[type="text"] {
            width: calc(100% - 22px); /* Ширина минус padding+border */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }

        .modal-content_apg input[type="text"]:focus {
            outline: 2px solid #007bff;
            outline-offset: 1px;
        }

        .modal-buttons_apg { /* Переименовал, чтобы не конфликтовать с вашим .modal-footer */
            display: flex;
            justify-content: flex-end;
            gap: 10px; /* Отступ между кнопками */
            margin-top: 25px;
        }

        .modal-buttons_apg button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }

        .modal-buttons_apg button.cancel {
            background-color: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
        }

        .modal-buttons_apg button.cancel:hover {
            background-color: #e0e0e0;
        }
        .modal-buttons_apg button.cancel:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }

        .modal-buttons_apg button.save {
            background-color: #007bff;
            color: #fff;
        }

        .modal-buttons_apg button.save:hover {
            background-color: #0056b3;
        }
        .modal-buttons_apg button.save:focus {
            outline: 2px solid #0056b3;
            outline-offset: 2px;
        }
        /* --- КОНЕЦ СТИЛЕЙ ДЛЯ ДИАЛОГА APG --- */


    </style>
</head>
<body>
    <div class="container" id="main-content">
        <h1>Демонстрация доступности: Новые вопросы</h1>

        <div class="demo-block list-demo">
            <h2>Проблема некорректных элементов в списках `&lt;ul&gt;` и `&lt;ol&gt;`</h2>
            <p>Ниже представлен список, содержащий некорректные прямые дочерние элементы, не являющиеся `<li>`. Визуально некорректные элементы не выглядят как пункты списка.</p>
            <ul>
                <li>Корректный элемент списка 1.</li>
                <div class="list-item-unified">Этот div является некорректным элементом внутри ul. Он нарушает структуру списка.</div>
                <li>Корректный элемент списка 2.</li>
                <p class="list-item-unified">Этот параграф также нарушает структуру списка, находясь напрямую внутри ul.</p>
                <li>Корректный элемент списка 3.</li>
            </ul>
            <p class="auditor-note"><strong>Для аудитора:</strong> Обратите внимание, что визуально некорректные элементы не имеют маркеров. Проверьте, как скринридеры (например, NVDA) сообщают о количестве элементов в списке и озвучивают ли они некорректные элементы при навигации по элементам списка (например, клавишей "i"). Это покажет, как семантическое нарушение проявляется как визуально, так и для вспомогательных технологий, когда нет стилей, "исправляющих" вид.</p>
        </div>

        <div class="demo-block search-demo">
            <h2>Поля ввода: "Поиск" vs "Текст" (визуально похожи, семантически различны)</h2>
            <p>Здесь представлены два поля ввода, визуально оформленные как поля поиска с кнопкой. Однако они используют разные типы: `type="search"` и `type="text"`. Цель этой демонстрации - показать, что внешний вид не всегда соответствует семантике, и как это влияет на доступность.</p>
            
            <form onsubmit="return false;">
                <div class="form-group">
                    <label for="search-input-search">Поиск по статьям (`type="search"`):</label>
                    <input type="search" id="search-input-search" name="q_search" placeholder="Введите запрос...">
                </div>
                <button type="submit">Искать</button>
            </form>
            
            <form onsubmit="return false;">
                <div class="form-group">
                    <label for="search-input-text">Обычное текстовое поле (`type="text"`):</label>
                    <input type="text" id="search-input-text" name="q_text" placeholder="Введите текст...">
                </div>
                <button type="submit">Искать</button>
            </form>

            <p class="auditor-note"><strong>Для аудитора:</strong> Взаимодействуйте с обоими полями, несмотря на их схожий внешний вид. Обратите внимание на различия в поведении: например, автозаполнение, кнопку очистки (в некоторых браузерах) и специальную мобильную клавиатуру у `type="search"`. Для скринридера поле `type="search"` может быть озвучено как "поле поиска", а `type="text"` как "поле редактирования". Это ключевая разница, которая не видна визуально.</p>
        </div>

        <div class="demo-block table-demo">
            <h2>Таблица и её доступное имя (Accessible Name)</h2>
            <p>Представлена таблица без явного доступного имени. Для пользователей скринридеров это может быть проблемой, так как они не узнают о её содержимом, пока не начнут перемещаться по ячейкам.</p>
            <table id="demo-table">
                <thead>
                    <tr>
                        <th>Продукт</th>
                        <th>Кол-во</th>
                        <th>Цена</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ноутбук</td>
                        <td>2</td>
                        <td>$1200</td>
                    </tr>
                    <tr>
                        <td>Монитор</td>
                        <td>3</td>
                        <td>$300</td>
                    </tr>
                    <tr>
                        <td>Клавиатура</td>
                        <td>5</td>
                        <td>$75</td>
                    </tr>
                </tbody>
            </table>
            <div class="table-controls">
                <button id="toggle-aria-label">Применить aria-label</button>
            </div>
            <p class="auditor-note"><strong>Для аудитора:</strong> Активируйте скринридер и услышьте, что он говорит при навигации к этой таблице. Используйте кнопку для динамического добавления/удаления `aria-label` и сравните разницу в озвучивании. Обратите внимание, что скринридер должен озвучить новое название кнопки сразу после нажатия.</p>
        </div>

        <div class="demo-block textarea-demo">
            <h2>`textarea` со счётчиком знаков и `aria-live="polite"`</h2>
            <p>Ниже поле для ввода текста с динамическим счётчиком оставшихся символов. Элемент со счётчиком использует `aria-live="polite"` для доступного объявления изменений.</p>
            <label for="message-input">Ваше сообщение (макс. 100 символов):</label>
            <textarea id="message-input" maxlength="100" placeholder="Начните вводить текст здесь..."></textarea>
            <div class="char-count" aria-live="polite">
                Осталось символов: <span id="chars-remaining">100</span>
            </div>
            <p class="auditor-note"><strong>Для аудитора:</strong> Введите текст в поле и обратите внимание, как скринридер озвучивает изменения счётчика символов, не прерывая вашего ввода. </p>
        </div>

        <div class="demo-block popup-demo">
            <h2>Модальное окно на основе примера ARIA APG</h2>
            <p>Эта демонстрация использует проверенную структуру и логику модального диалога из ARIA Authoring Practices Guide.</p>
            <button id="open-modal-no-aria">Открыть окно (без `aria-haspopup`)</button>
            <button id="open-modal-with-aria" aria-haspopup="dialog">Открыть окно (с `aria-haspopup="dialog`)</button>
            <p class="auditor-note"><strong>Для аудитора:</strong> Активируйте скринридер. Наведите фокус на каждую кнопку и сравните, что озвучивает скринридер перед нажатием. Затем нажмите каждую кнопку. Обратите внимание, что фокус автоматически перемещается в модальное окно на первое поле ввода. Попробуйте навигироваться клавишей `Tab` внутри окна и за его пределами (фокус должен оставаться внутри). Закройте окно кнопкой `Escape`, "Отмена" или "Сохранить" и убедитесь, что фокус возвращается на вызвавшую кнопку.</p>
        </div>

    </div>

    <div role="dialog"
         id="demo-modal"
         aria-labelledby="dialog-apg-label"
         aria-describedby="dialog-apg-description"
         aria-modal="true"
         class="modal-overlay"
         style="display: none;">
        <div class="modal-content_apg">
            <h2 id="dialog-apg-label">Редактировать адрес доставки</h2>
            <div id="dialog-apg-description">Заполните поля, чтобы обновить адрес доставки.</div>
            <form>
                <div>
                    <label for="street">Улица:</label>
                    <input type="text" id="street" value="123 Main Street">
                </div>
                <div>
                    <label for="city">Город:</label>
                    <input type="text" id="city" value="Anytown">
                </div>
                <div>
                    <label for="state">Штат:</label>
                    <input type="text" id="state" value="CA">
                </div>
                <div>
                    <label for="zip">Индекс:</label>
                    <input type="text" id="zip" value="90210">
                </div>
                <div class="modal-buttons_apg">
                    <button type="button" value="cancel" class="cancel">Отмена</button>
                    <button type="button" value="save" class="save">Сохранить</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // Скрипт для счетчика символов в textarea
        const textarea = document.getElementById('message-input');
        const charsRemainingSpan = document.getElementById('chars-remaining');
        const charCountDiv = document.querySelector('.char-count');
        const maxLength = textarea.getAttribute('maxlength');

        textarea.addEventListener('input', () => {
            const currentLength = textarea.value.length;
            const remaining = maxLength - currentLength;
            charsRemainingSpan.textContent = remaining;

            if (remaining <= 10 && remaining > 0) {
                charCountDiv.classList.remove('error');
                charCountDiv.classList.add('warning');
            } else if (remaining === 0) {
                charCountDiv.classList.add('error');
            } else {
                charCountDiv.classList.remove('warning', 'error');
            }
        });

        // Скрипт для интерактивной таблицы
        const demoTable = document.getElementById('demo-table');
        const toggleAriaLabelBtn = document.getElementById('toggle-aria-label');
        const tableAriaLabelText = "Данные о продажах продуктов";

        toggleAriaLabelBtn.addEventListener('click', () => {
            if (demoTable.hasAttribute('aria-label')) {
                demoTable.removeAttribute('aria-label');
                toggleAriaLabelBtn.textContent = 'Применить aria-label';
                toggleAriaLabelBtn.classList.remove('remove-btn');
                toggleAriaLabelBtn.setAttribute('aria-label', 'Применить aria-label к таблице');
            } else {
                demoTable.setAttribute('aria-label', tableAriaLabelText);
                toggleAriaLabelBtn.textContent = 'Удалить aria-label';
                toggleAriaLabelBtn.classList.add('remove-btn');
                toggleAriaLabelBtn.setAttribute('aria-label', 'Удалить aria-label из таблицы');
            }
        });
        toggleAriaLabelBtn.setAttribute('aria-label', 'Применить aria-label к таблице');


        // --- СКРИПТ УПРАВЛЕНИЯ МОДАЛЬНЫМ ОКНОМ (НА ОСНОВЕ APG, без aria-expanded) ---
        const openModalNoAriaBtn = document.getElementById('open-modal-no-aria');
        const openModalWithAriaBtn = document.getElementById('open-modal-with-aria');
        const demoModal = document.getElementById('demo-modal'); // Теперь это ваш APG-диалог
        const mainContent = document.getElementById('main-content'); // Основной контент страницы

        let lastFocusedElement = null; // Для хранения ссылки на элемент, который открыл модальное окно

        // Function to show the dialog
        function openDialog(triggerButton) {
            // Сохраняем текущий сфокусированный элемент для восстановления позже
            lastFocusedElement = document.activeElement;

            demoModal.style.display = 'flex'; // Показываем модальное окно
            mainContent.setAttribute('aria-hidden', 'true'); // Скрываем основной контент для скринридеров

            // Находим все фокусабельные элементы внутри диалога
            var focusableEls = demoModal.querySelectorAll(
                'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]'
            );
            var firstFocusable = focusableEls[0];

            // Устанавливаем фокус на первый фокусабельный элемент (или на сам диалог как запасной вариант)
            setTimeout(function() {
                if (firstFocusable) {
                    firstFocusable.focus();
                } else {
                    demoModal.focus(); // Запасной вариант, если нет фокусабельных элементов
                }
            }, 10); // Небольшая задержка, часто рекомендуется для изменений фокуса

            demoModal.addEventListener('keydown', handleDialogKeyDown);
        }

        // Function to hide the dialog
        function closeDialog() {
            demoModal.style.display = 'none'; // Скрываем модальное окно
            mainContent.setAttribute('aria-hidden', 'false'); // Возвращаем основной контент

            // Восстанавливаем фокус на элемент, который открыл диалог
            if (lastFocusedElement) {
                lastFocusedElement.focus();
                lastFocusedElement = null;
            }

            demoModal.removeEventListener('keydown', handleDialogKeyDown);
        }

        // Handle keyboard events in the dialog
        function handleDialogKeyDown(event) {
            if (event.key === 'Escape') {
                closeDialog();
                event.stopPropagation(); // Предотвращаем дальнейшую обработку Escape
            } else if (event.key === 'Tab') {
                // Получаем текущие фокусабельные элементы внутри диалога
                var focusableEls = demoModal.querySelectorAll(
                    'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]'
                );
                var firstFocusable = focusableEls[0];
                var lastFocusable = focusableEls[focusableEls.length - 1];

                if (event.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusable) {
                        lastFocusable.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusable) {
                        firstFocusable.focus();
                        event.preventDefault();
                    }
                }
            }
        }

        // Привязываем обработчики открытия модального окна к вашим кнопкам
        openModalNoAriaBtn.addEventListener('click', () => openDialog(openModalNoAriaBtn));
        openModalWithAriaBtn.addEventListener('click', () => openDialog(openModalWithAriaBtn));
        
        // Привязываем обработчики закрытия к кнопкам внутри нового диалога
        var cancelButton = demoModal.querySelector('button.cancel');
        var saveButton = demoModal.querySelector('button.save');

        if (cancelButton) {
            cancelButton.addEventListener('click', closeDialog);
        }
        if (saveButton) {
            saveButton.addEventListener('click', closeDialog);
        }

        // Устанавливаем tabindex="-1" для самого модального окна, чтобы оно могло получить фокус программно
        // если нет других фокусабельных элементов, но не было доступно по Tab напрямую.
        demoModal.setAttribute('tabindex', '-1');
        // --- КОНЕЦ СКРИПТА УПРАВЛЕНИЯ МОДАЛЬНЫМ ОКНОМ ---
    </script>
</body>
</html>